<body>

  <div class="jumbotron">
    <h1> <%= @execute         %></h1>
    	 <% flash[:notice]="" %>
  </div>

  <% case @execute    %>   
  <% when "repartir"  %>  
      <% mc_A_repartir = save_MetaclassesEnTraitement  %>
      <h4> <%= mc_A_repartir %></h4> 
      <%  $pid = fork do                                                     %>
      <%       system "./repartir.sh '#{mc_A_repartir}'" %>
      <%     end                                                             %>
      <h4><br><br><font color="red"><bold>
      <%= " OPERATION [ #{@execute} ] en cours (pid: #{$pid}).............." %>
      <br>
      <%= "--> BUT: VOIR les repartitions a l'ecran du terminal rails"       %>
      </h4></font></bold>

  <% when "valider"  %> 
      <%  repFiliere,nbLignes,nomFiliere = filiere($repCedulables)           %> 
      <% mc_A_valider = save_MetaclassesEnTraitement                         %>
      <h4> <%= mc_A_valider %></h4> 
      <%  $pid = fork do                                                     %>
      <%       Signal.trap("HUP"){puts "Ouch!" ; exit}                       %>
      <%       executionSansErreur = system "./valider.sh '#{mc_A_valider}'" %>
      <%     end                                                             %>
      <%  sleep 3                                                            %>
      <h4><br><br><font color="red"><bold>
      <%= " OPERATION [ #{@execute} ] en cours (pid: #{$pid}).............." %>
      <br><br><font color="blue"><bold>
      <%= "--> BUT: TROUVER des cedulables a partir [hor/op/cedulables]"     %>
      <br>
      <%= "         SOURCE:         [ #{nomFiliere} ]"                       %>
      <br>
      <%  repFiliere,nbLignes,nomFiliere = filiere($repCedulables)           %> 
      <%= "         DESTINATION:    [ #{nomFiliere} ]"                       %>
      <br>
      <%= "         Rafraichir [ #{nomFiliere} ] Editeur de fichiers CTRL-R "%>
      </h4></font></bold>


  <% when "invalider"  %> 
      <% repFiliere,nbLignes,nomFiliere = filiere($repCedulables) %> 
      <% executionSansErreur = system "./invalider.sh"            %>
      <% if executionSansErreur then                              %>
	<h4><br><br><font color="red"><bold>
	<%= " OPERATION [ #{@execute} ] en cours (pid: #{$pid}).............." %>
	<br>
	<%= "--> BUT: EFFACER la filiere [ #{nomFiliere} ]"                    %>
	<br>
	<%  repFiliere,nbLignes,nomFiliere = filiere($repCedulables)           %> 
	<%= "--> La derniere filiere de CEDULABLES est [ #{nomFiliere} ]"      %>
      <% end     %>
      </h4></font></bold>


  <% when "filtrer"     %> 
      <% intervalle = obtenirIntervalle(diviseur = 30)             %> 
      <% repFiliere,nbLignes,nomFiliere = filiere($repCedulables)  %> 
      <%       system "./filtrer.sh '#{intervalle}'"               %>
      <h4><br><br><font color="red"><bold>
      <%= " OPERATION [ #{@execute} ] en cours (pid: #{$pid}).............."      %>
      <br>
      <%= "--> RENOMMER: filiere originale [op/cedulables/0_#{nomFiliere}]_"      %>
      <br>
      <%= "--> BUT: FILTRER a #{intervalle} lignes d'intervalle [ #{nomFiliere} ]"%>
      </h4></font></bold>


  <% when "variance" %> 
      <% repFiliere,nbLignes,nomFiliere = filiere($repCedulables)  %> 
      <% $pid = fork do                                            %>
      <%    system "./variance.sh"                                 %>
      <%     end                                                   %>
      <h4><br><br><font color="red"><bold>
      <%= " OPERATION [ #{@execute} ] en cours (pid: #{$pid})....."%>
      <br>
      <%= "--> BUT: TRIER selon la VARIANCE de [ #{nomFiliere} ]"  %>
      <br>
      <%= "--> RAPPEL: Variances basses = meilleures repartitions]"%>
      </h4></font></bold>      
      
      
  <% when "infoCeds" %> 
      <% horaireTemp = obtenirCedulablesHoraire                               %> 
      <% repFiliere,nbLignes,nomFiliere = filiere($repCedulables)             %> 
      <% $pid = fork do                                                       %>
      <%       system "./infoCeds.sh #{horaireTemp}"                          %>
      <%     end                                                              %>
      <h4><br><br><font color="red"><bold>
      <%= " OPERATION [ #{@execute} ] en cours (pid: #{$pid}).............."  %>
      <br>
      <%= "--> Les CEDULABLES de [ #{nomFiliere} ] sont temporairement fixes" %>
      <br>
      <%= "--> BUT: Obtenir les hor13/info/ selon 1re ligne [ #{nomFiliere} ]"%>
      <br>
      <%= "         Fixer ces horaires dans le PAS (Planif. Annee Scolaire)  "%>
      <br>
      <%= "--> ETAT FINAL: [ data/horaires.txt ] remis au statut precedent   "%>
      </h4></font></bold>


  <% when "infoHor" %>
      <% $pid = fork do                %>
      <%       system "./infoHor.sh"   %>
      <%     end                       %>
      <h4><br><br><font color="red"><bold>
      <%= " OPERATION [ #{@execute} ] en cours (pid: #{$pid}).............."%>
      <br>
      <%= "--> BUT: Mettre a jour: [hor13/info/...] avec l'horaire officiel"%>
      <br>
      <%= "         Fixer ces horaires dans le PAS (Planif. Annee Scolaire)"%>
      <br>
      <%= "--> ETAT FINAL: [hor13/info/..] a partir de [ data/horaires.txt ]"%>
      </h4></font></bold>

  
  <% when "data"  %>
      <% $pid = fork do            %>
      <%       system "./data.sh"  %>
      <%     end                   %>
      <h4><br><br><font color="red"><bold>
      <%= " OPERATION [ #{@execute} ] en cours (pid: #{$pid}).............."     %>
      <br>
      <%= "--> BUT: BASE DE DONNEES mise a JOUR                                 "%>
      <br>
      <%= "--> SOURCE: PAS (Planif. Annee Scolaire) sur le Web"                  %>
      <br>
      <%= "--> DESTINATION: [hor13/init/] (metaclasses, classes, metas, profs, locaux) "%>
      <br>
      <%= "--> VOIR le transfert a l'ecran du terminal rails"                     %>
      </h4></font></bold>


  <% when "de-select" #ne fonctionne pas avec action.html.erb%>
  <% when "fix-Reps"%> 
  <% when "ceduler" %> 
  <% when "viable"  %> 
  <% when "compact" %>
  <% when "diago"   %> 
  <% when "flat?"   %> 
      <h3> <%= "PROGRAMME EN CONSTRUCTION" %> </h3>
  
  
  <% when "fix-hor" %> 
      <% #horaireTemp = obtenirDiagHoraire                       %> 
      <% #repFiliere,nbLignes,nomFiliere = filiere($repDiag)     %> 
      <% $pid = fork do                                                       %>
      <%       system "./fix_hor.sh #{horaireTemp}"                           %>
      <%     end                                                              %>
      <h4><br><br><font color="red"><bold>
      <%= " OPERATION [ #{@execute} ] en cours (pid: #{$pid}).............."  %>
      <br>
      <%= "--> Les CEDULABLES DIAGONALISES de [ #{nomFiliere} ] seront fixes" %>
      <br>
      <%= "--> BUT: Obtenir [hor13/info/] selon 1re ligne [ #{nomFiliere} ]  "%>
      <br>
      <%= "         Fixer ces horaires dans le PAS (Planif. Annee Scolaire)  "%>
      <br>
      <%= "--> ETAT FINAL:[ data/horaires.txt ] contient l'horaire diagonalise"%>
      </h4></font></bold>

  
  <% when "stop"  %>
      <%= "Process.kill('HUP', $pid)" %>
      <% Process.kill("HUP", $pid) %>
	<h4><br><br><font color="red"><bold>
	<%= " OPERATION [ #{@execute} ] en cours (pid: #{$pid}).............." %>
	<br>
        <%= "--> BUT: STOPPER le processus (pid: #{$pid}) "%>
	<br>
      </h4></font></bold>

      
  
  <% else              %> 
      <h3> <%= "Aucune des actions programmees ne correpond a votre demande" %> </h3>
  <% end               %> 
  
  

  <% @blocMC = "index" unless @blocMC  %>
  <br>
  <%= link_to "AFFICHER: "+@blocMC,blocMetaclasses_path(:execute => @execute, :blocMC => @blocMC),class:"btn btn-info" %>
  
 
</body>